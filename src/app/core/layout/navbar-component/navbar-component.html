<button
  class="mnv-toggle"
  type="button"
  aria-label="Toggle menu"
  (click)="toggle()"
>
  <span [class.open]="isOpen"></span>
</button>

@if (isOpen) {
  <div class="mnv-overlay" (click)="close()"></div>
}

<nav class="rail mnv-sidebar" role="navigation" aria-label="Main" [class.open]="isOpen">
  <div class="rail__header" routerLink="/">
    <div class="brand">
      <img src="../../../../assets/img/left_horz.svg" alt="Monova logo" class="navbar-logo" />
    </div>
  </div>

  <ul class="rail__nav">
    @for (item of menu; track item.label) {
      <li class="nav-item" [class.has-children]="!!item.children" [class.is-open]="openKey===item.key">
        @if (item.children?.length) {
          <button class="nav-link" type="button" (click)="toggleSection(item.key)">
            <span class="label">{{ item.label | translate }}</span>
            <span class="chev" aria-hidden="true">▸</span>
          </button>
        @if (openKey===item.key) {
            <ul class="subnav">
              @for (c of item.children; track c.label) {
                <li><a href="/jobs?country={{ c.link }}">{{ c.label | translate }}</a></li>
              }
            </ul>
          }
        } @else {
          <a class="nav-link" [routerLink]="item.link" routerLinkActive="active" [routerLinkActiveOptions]="{ exact: true }">
            <span class="label">{{ item.label | translate }}</span>
          </a>
        }
      </li>
    }
  </ul>

  <div class="rail__bottom">
    <div class="profile">
      @if (auth.isLoggedIn()) {
        <div class="profile">
          <a routerLink="/profile" class="profile__pill">
            <div class="profile__avatar">
              {{ (auth.currentUser()?.name || auth.currentUser()?.email || 'U').charAt(0) }}
            </div>
            <div class="profile__text">
              <div class="profile__name">
                {{ auth.currentUser()?.name || auth.currentUser()?.email }}
              </div>
              <div class="profile__sub">View profile</div>
            </div>
          </a>

          <button type="button" class="btn btn--primary" (click)="auth.logout()">
            Log out
          </button>
        </div>
      } @else {
        <div class="login-buttons">
          <a class="btn btn--primary" routerLink="/auth/login">
            {{ 'NAV.SIGN_IN' | translate }}
          </a>
          <a class="btn btn--outline" routerLink="/auth/register">
            {{ 'NAV.SIGN_UP' | translate }}
          </a>
        </div>
      }
    </div>
    <div class="socials" aria-label="Social media">
        @for (s of socials; track s.key) {
            <a class="sbtn" [href]="s.href" target="_blank" rel="noopener" aria-label="{{ s.label }}">
            @switch (s.key) {
                @case ('tiktok') {
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path d="M13 3h3a5 5 0 0 0 5 5v3a8 8 0 1 1-8-8Z"/>
                </svg>
                }
                @case ('linkedin') {
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path d="M4 3a2 2 0 1 1 0 4 2 2 0 0 1 0-4Zm1 5H3v13h2V8Zm5 0H8v13h2v-7c0-2.21 3-2.39 3 0v7h2v-8c0-4.17-4.5-4-5-2.29V8Z"/>
                </svg>
                }
                @case ('facebook') {
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path d="M14 9h3V6h-3a3 3 0 0 0-3 3v3H8v3h3v6h3v-6h3l1-3h-4V9a1 1 0 0 1 1-1Z"/>
                </svg>
                }
                @case ('instagram') {
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <path d="M7 2h10a5 5 0 0 1 5 5v10a5 5 0 0 1-5 5H7a5 5 0 0 1-5-5V7a5 5 0 0 1 5-5Zm5 6a5 5 0 1 0 5 5 5 5 0 0 0-5-5Zm6.5-1.75a1.25 1.25 0 1 0 1.25 1.25 1.25 1.25 0 0 0-1.25-1.25Z"/>
                </svg>
                }
                @default {
                <svg viewBox="0 0 24 24" width="18" height="18" fill="currentColor">
                    <circle cx="12" cy="12" r="9"></circle>
                </svg>
                }
            }
            </a>
        }
    </div>

    <div class="langs" role="group" aria-label="Languages">
      @for (l of langs; track l.code) {
        <button
          type="button"
          class="lang-pill"
          [class.active]="activeLang===l.code"
          (click)="setLang(l.code)">
          {{ l.code }}
        </button>
      }
    </div>
  </div>

  @if (drawerOpen) {
    <div class="drawer" (click)="closeDrawer()">
      <aside class="drawer__panel" (click)="$event.stopPropagation()">
        <button class="drawer__close" (click)="closeDrawer()" aria-label="Close">×</button>
        <div class="brand brand--drawer">
          <div class="brand__name">MONOVA</div>
          <div class="brand__tag">Recruitment</div>
        </div>
        <ul class="drawer__nav">
          @for (item of menu; track item.label) {
            <li>
              @if (item.children?.length) {
                <div class="drawer__heading">{{ item.label }}</div>
                <ul>
                  @for (c of item.children; track c.label) {
                    <li><a [routerLink]="c.link" (click)="closeDrawer()">{{ c.label }}</a></li>
                  }
                </ul>
              } @else {
                <a [routerLink]="item.link" (click)="closeDrawer()">{{ item.label }}</a>
              }
            </li>
          }
        </ul>
        <div class="drawer__langs">
          @for (l of langs; track l.code) {
            <button
              [class.active]="activeLang===l.code"
              (click)="setLang(l.code)">
              {{ l.code }}
            </button>
          }
        </div>
      </aside>
    </div>
  }
</nav>
